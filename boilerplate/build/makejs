#! /bin/sh

# HTML5 boilerplate tools
# This should be uncommented and changed to reflect your own tools install
#alias minify='java -jar ~/projects/html5-boilerplate/build/tools/closure-compiler-v1346.jar --js'

# minify and concatenate JS files
echo "Minification ...\n"
cp ../js/plugins.js tmp
echo "\n" >> tmp
minify ../js/main.js >> tmp

# remove previous file if needed
if [ -e jsbuild.php ]
then
    old=`cat jsbuild.php | cut -d \' -f4`
    if [ ${old} -a -e ../js/${old}.min.js ] 
    then
         rm ../js/${old}.min.js
         echo "../js/${old}.min.js removed"
    fi
fi

# rename the new file from its MD5 hash
hash=`md5sum tmp|cut -c 1-8`
mv tmp ../js/${hash}.min.js
echo "Minified file ../js/${hash}.min.js created successfully\n"

# declare the file name in PHP
echo "<?php define('JSBUILD', '${hash}'); ?>" > jsbuild.php
